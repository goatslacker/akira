var ast = require('ast');
var VariableDeclaration = require('ast/VariableDeclaration');

function addScope(context, body, evald) {
  var fn = Object.keys(context).map(function (variable) {
    if (variable.substr(0, 3) === '$$$') {
      return null;
    }
    return ast(variable, context);
  });

  var scope = VariableDeclaration(fn.filter(function (x) { return !!x; }));

  if (scope.declarations.length > 0) {
    body = [scope].concat(body);
  }

  return body;
}

module.exports = addScope;
