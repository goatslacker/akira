var VariableDeclaration = require('ast/VariableDeclaration');
var ast = require('ast');
var lz = require('lz');

function addScope(context, body, evald) {
  var scope = VariableDeclaration(new lz(Object.keys(context))
    .map(function (symbol) {
      if (symbol.substr(0, 3) === '$$$') {
        return null;
      }
      return ast(symbol, context);
    })
    .compact()
    .toArray()
  );

  if (scope.declarations.length > 0) {
    return [scope].concat(body);
  } else {
    return body;
  }
}

module.exports = addScope;
