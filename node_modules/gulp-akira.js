module.exports = gulpAkira

var akira = require('../')
var gutil = require('gulp-util')
var through = require('through2')
var PluginError = gutil.PluginError

const PLUGIN_NAME = 'gulp-akira'

function gulpAkira(f) {
  return through.obj(function (file, encoding, callback) {
    if (file.isNull()) {
      return callback(null, file)
    }

    if (file.isStream()) {
      return callback(new PluginError(PLUGIN_NAME, 'Streaming not supported', {
        fileName: file.path,
        showStack: false
      }))
    }

    if (file.isBuffer()) {
      file.contents = new Buffer(f.call(akira, String(file.contents), file))
    }

    this.push(file)

    return callback()
  })
}
