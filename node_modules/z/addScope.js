var VariableDeclaration = require('ast/VariableDeclaration');
var ast = require('ast');
var fu = require('fu');

function addScope(context, body, evald) {
  var vars = Object.keys(context)

  var declarations = fu.compact(fu.map(function (symbol) {
    if (symbol.substr(0, 3) === '$$$') {
      return null;
    }
    return ast(symbol, context);
  }, vars))

  var scope = VariableDeclaration(declarations)

  if (scope.declarations.length > 0) {
    return [scope].concat(body);
  } else {
    return body;
  }
}

module.exports = addScope;
