function implicitReturn(body) {
  var ret = body[body.length - 1];
  ret = ret.type === 'ExpressionStatement' ? ret.expression : ret;

  switch (ret.type) {
    case 'ThrowStatement':
    case 'ForInStatement':
      return;
  }

  if (ret.type === 'TryStatement') {
    implicitReturn(ret.block.body);
    return;
  } else if (ret.type === 'SwitchStatement') {
    if (ret.__cond === true) {
      ret.cases.forEach(function (x) {
        implicitReturn(x.consequent);
      });
    } else {
      return;
    }
  } else if (ret.type === 'IfStatement') {
    implicitReturn(ret.consequent.body);
    ret.alternate && implicitReturn(ret.alternate.body);
  } else {
    body[body.length - 1] = {
      type: 'ReturnStatement',
      argument: ret
    };
  }
}

module.exports = implicitReturn;
